# Tennis Era Analysis

## 1. How to Run the Project

1.  **Clone the repository:**
    ```bash
    git clone <your-repository-url>
    cd Tennis_Era_Analysis
    ```
2.  **Install dependencies:**
    Ensure you have [Poetry](https://python-poetry.org/docs/#installation) installed. Then run:
    ```bash
    poetry install
    ```
3.  **Activate the virtual environment:**
    You can run commands within the Poetry-managed environment using `poetry run`:
    ```bash
    poetry run python your_script_name.py
    ```
    Alternatively, you can spawn a shell within the environment:
    ```bash
    poetry shell
    ```
4.  **Running specific analyses/scripts:**
    *   To run the main analysis pipeline (example):
        ```bash
        poetry run python tennis_era_analysis.py
        ```
    *   To re-aggregate raw data (example):
        ```bash
        poetry run python aggregate_raw_data.py
        ```
    *   (Add more specific instructions as scripts are developed)

**Note on Data:**
The project expects raw data files to be placed in the `data/atp_matches/`, `data/atp_point_by_point/`, and `data/slam_point_by_point/` directories. These files are typically downloaded from the sources mentioned in section 3.2. Due to their size, they are often not committed to the Git repository (ensure `.gitignore` is configured appropriately if this is the case). The `aggregate_raw_data.py` script can be used to process these raw files if needed. The `tennis.duckdb` file is generated by the project; ensure it is either tracked or gitignored based on your preference.

## 2. Project Goal

The primary goal of this project is to analyze the evolution of tennis over the last 20 years (approximately 2005-2025). We aim to develop a methodology to measure player improvements over time and apply this to compare players from different eras, simulating hypothetical matchups.

## 3. Roadmap

Below is a research plan for measuring and explaining how men's (and, with minor tweaks, women's) tennis performance has shifted from ≈ 2005 to 2025.

### 3.1. Defining "Performance"
Performance can be understood in four overlapping layers, each with measurable proxies:

| Layer                               | Typical proxies (examples)                                                                  | Notes on 2005-vs-2025 relevance                                                                                                   |
| :---------------------------------- | :------------------------------------------------------------------------------------------ | :-------------------------------------------------------------------------------------------------------------------------------- |
| **Technical** (ball control & shot production) | • Serve & ground-stroke speed/spin (mph, rpm) <br> • Placement dispersion <br> • Expected-winner probability per shot | Racquet, string, and ball changes affect raw speeds; normalise to contemporaries to avoid bias. <br> [humcap.uchicago.edu](https://humcap.uchicago.edu) |
| **Physical** (movement & endurance)  | • Distance covered per point <br> • Top speed, acceleration <br> • Heart-rate/HRV or Catapult load           | Optical/IMU tracking only became ubiquitous post-2019, so pre-2010 data need video-derived estimates.                             |
| **Tactical** (pattern quality)       | • Rally-length distribution <br> • % serve-plus-one patterns <br> • Return depth maps                        | Hawk-Eye & similar systems give full 3-D ball paths from ≈ 2006 on the main tour. <br> [tandfonline.com](https://www.tandfonline.com)     |
| **Outcome**                          | • Point-, game-, set-, match-win % <br> • Surface-split Elo/Glicko ratings                    | Elo inflation/deflation must be corrected for era comparisons. <br> [tennisabstract.com](https://www.tennisabstract.com)                |

### 3.2. Primary Data Sources

| Granularity                               | What to collect                                                                                                | Public availability?                                                                                                                               | Notes                                                                                                                                           |
| :---------------------------------------- | :------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------- |
| Match-summary stats (ATP, since ~1968)    | Yearly CSVs: `atp_matches_YYYY.csv` (e.g., scores, winner/loser, tournament details, surface, round, etc.)      | [JeffSackmann/tennis_atp](https://github.com/JeffSackmann/tennis_atp/tree/master)                                                                   | Data from `data/atp_matches/` directory. Includes tour-level main draw, qualifying, challengers, and futures.                                           |
| Point-level logs (ATP, since ~2011)       | `pbp_matches_atp_main_current.csv`, `pbp_matches_atp_main_archive.csv` (server/returner, score, point outcome) | [JeffSackmann/tennis_pointbypoint](https://github.com/JeffSackmann/tennis_pointbypoint)                                                          | Data from `data/atp_point_by_point/` directory. Coverage primarily for ATP main tour matches.                                                              |
| Point-level logs (Grand Slams, since ~2011) | Yearly CSVs per Slam: `YYYY-<slam>-matches.csv`, `YYYY-<slam>-points.csv` (detailed point progression)         | [JeffSackmann/tennis_slam_pointbypoint](https://github.com/JeffSackmann/tennis_slam_pointbypoint)                                                 | Data from `data/slam_point_by_point/` directory. Includes match details and point-by-point logs for Australian Open, French Open, Wimbledon, US Open. |
| Ball-tracking (Hawk-Eye/FoxTenn)          | 3-D ball & player coordinates @ 50–150 Hz                                                                      | Limited open data (Wimbledon 2012-, finals). Broader via partnerships or Sportradar/StatsPerform licenses.                                       | Not currently in use; potential future source.                                                                                                  |
| Wearables/biomech                         | Racket-sensor rpm, player IMU load                                                                             | Mostly proprietary; possible via targeted studies or ITF-sponsored releases.                                                                       | Not currently in use; potential future source.                                                                                                  |
| Context                                   | Surface pace index, ball type, weather                                                                         | ITF court pace ratings; publicly logged ball contracts; NOAA weather API. Some surface info in `tennis_atp` data.                               | Partially covered by existing data; can be augmented.                                                                                           |

### 3.3. Normalising Across Eras

*   **Within-season z-scores:** Convert each stat to a z-score relative to the tour mean of that season & surface (avoids raw-speed bias).
*   **Era-adjusted Elo:**
    *   Use point-level win probs to compute "surface-specific Elo".
    *   Apply a Bayesian shrinkage term that ties each season's rating distribution to an anchor season (e.g. 2010) to control inflation.
*   **Equipment/surface covariates:** Add dummy variables for racquet-tech step-changes (graphite → poly strings, larger head-sizes) and for pace-index drift of each Slam (grass slowed ~2003, clay sped up slightly).
*   **Opponent-strength weighting:** Weight each performance metric by the expected % of top-20 opponents that year to handle depth-of-field changes.

### 3.4. Analytical Pipeline

| Stage             | Method                                                                             | Deliverable                                                                                                     |
| :---------------- | :--------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------- |
| Data ingestion    | Scrape/API ▶ Postgres or DuckDB                                                    | Clean, reproducible DB                                                                                          |
| Feature engineering | SQL/UDFs for z-scores; Python for kinematic features; match → point → shot linking | `features.parquet`                                                                                               |
| Exploratory       | PCA/UMAP to see which dimensions actually changed; time-series decomposition       | Trend plots (serve speed ↑1 %/yr until ~2017, then flat - [Brain Game Tennis](https://www.braingametennis.com/)) |
| Model             | Hierarchical Bayesian logistic: P(win) ~ era-norm stats + player random intercept    | Era-neutral skill estimates w/ posterior intervals                                                              |
| Simulation        | Monte-Carlo best-of-five with point-level transition matrix drawn from posterior     | "Federer-2006 vs Alcaraz-2025" win % with 90 % CrI                                                             |
| Interpretation    | SHAP/ICE on model; counterfactuals (What if 2025 rackets on 2005 clay?)           | Narrative + visuals                                                                                             |

### 3.5. Why This Matters & a Forward-Thinking Twist

Past → Present trends (e.g., rally length at Wimbledon has grown by ~2 shots on average since 2005 - [ResearchGate](https://www.researchgate.net/)) already hint that pure speed gains plateau while tactical & physical sophistication keep climbing.

Present → Future: Emerging AI-augmented coaching (on-court RL agents suggesting patterns in real time) and real-time biomech feedback will likely make tactical adaptability the biggest mover between 2025-2035, not raw power.

To model that, add:
*   Graph neural nets on shot sequences → predict pattern optimality.
*   "What-if" reinforcement-learning agents → optimise an old-era player's shot selection under 2025 constraints.

## 4. Current Status (as of last update before EDA)

| Layer                 | Implemented ✔︎                                                                      | Still missing / partial ✖︎                                                 | Comments                                   |
| :-------------------- | :-------------------------------------------------------------------------------- | :----------------------------------------------------------------------- | :----------------------------------------- |
| Match-level DB        | ✔ matches_*, matches_all, yearly KPI & z tables                                   | —                                                                        | Stable.                                    |
| Point-level ingestion | ✔ points_atp, points_slam, points_all with rally_len, rally_bin, serve_plus_one | ~30 % of tour matches still lack PBP; TB parsing not yet QC-checked      | Coverage limited by public feeds.          |
| Rally analytics       | ✔ analytics.match_rally_stats, basic serve/return stats                           | aggressor, importance, 1st/2nd-serve split                               | Need shot-level feeds or richer PBP.       |
| Era-adjusted Elo      | ✔ Unified (surface-agnostic) Elo, with year-end recentering and incremental rerun safety (see `elo.py`) | • Sanity-check dashboards <br> • uncertainty estimates <br> • optional surface-segmentation | Works end-to-end; ratings stored in `analytics.elo_player_season`. |
| QC suite              | ✔ row-count, ace/DF mismatch flags                                                | serve-alternation & score-replay checks                                  | Good enough for ingest reliability.        |
| Simulation / matchup engine | —                                                                               | ✖︎                                                                       | Not started.                               |

**Note on Current Development:**
*   Exploratory Data Analysis (EDA) has been completed.
*   We are currently developing `data_cleaning.py`.
*   The insights from EDA are significant and will require reconsideration of some implemented aspects and overall project structure.

## 5. TODO / Next Steps

*   [x] **Project Setup**
    *   [x] Initialize Git repository. (Assuming you have done this or will do it)
    *   [x] Create `.gitignore` file.
    *   [x] Make initial commit. (Assuming you will do this)
    *   [x] Initialize Poetry for dependency management.
    *   [x] Add existing and new dependencies via Poetry.
*   [ ] **Project Restructuring (Post-EDA)**
    *   [ ] Review EDA insights and identify necessary changes to data processing, feature engineering, and modeling approach.
    *   [ ] Refactor existing code (`data_cleaning.py`, `pbp_processing.py`, etc.) based on new understanding.
    *   [ ] Update feature engineering pipeline.
*   [ ] **Complete Data Ingestion & Cleaning**
    *   [ ] Address missing PBP data if possible.
    *   [ ] QC check Tie-Break parsing.
    *   [ ] Enhance QC suite (serve-alternation, score-replay checks).
*   [ ] **Enhance Rally Analytics**
    *   [ ] Implement aggressor identification.
    *   [ ] Implement point importance metrics.
    *   [ ] Differentiate 1st/2nd serve rally stats.
*   [ ] **Refine Elo Model**
    *   [ ] Develop sanity-check dashboards for Elo ratings.
    *   [ ] Implement uncertainty estimates for Elo ratings.
    *   [ ] Explore and optionally implement surface-segmented Elo.
*   [ ] **Develop Simulation Engine**
    *   [ ] Design and implement the Monte-Carlo simulation for matchups.
*   [ ] **Advanced Modeling (Forward-Thinking)**
    *   [ ] Explore Graph Neural Nets for shot sequence optimality.
    *   [ ] Investigate RL agents for "what-if" scenarios.
*   [ ] **Documentation & Reporting**
    *   [ ] Document data pipeline and models.
    *   [ ] Prepare final analysis report with narratives and visuals. 